<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Forgemaster Calculator — DPS Builder</title>
  <style>
    :root{--max-width:980px;--gap:12px}
    body{font-family:system-ui,-apple-system,'Segoe UI',Roboto,Helvetica,Arial,sans-serif;margin:0;padding:2rem;background:#f7fafc;color:#0f172a}
    .wrap{max-width:var(--max-width);margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem}
    h1{font-size:1.25rem;margin:0}
    .card{background:#fff;border:1px solid #e6edf3;border-radius:8px;padding:1rem;margin-bottom:1rem}
    .slots{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:var(--gap)}
    .slot{border:1px dashed #e2e8f0;padding:.75rem;border-radius:6px}
    .row{display:flex;gap:.5rem;align-items:center;margin-bottom:.5rem}
    label{font-size:.85rem;color:#374151;width:110px}
    input[type=number],select{flex:1;padding:.4rem;border:1px solid #cbd5e1;border-radius:4px}
    .small{width:80px}
    .controls{display:flex;gap:.5rem;flex-wrap:wrap}
    .summary{white-space:pre-wrap;font-family:monospace;background:#0f172a;color:#f8fafc;padding:.75rem;border-radius:6px;max-height:220px;overflow:auto}
    button{background:#0ea5a4;color:#fff;border:none;padding:.5rem .75rem;border-radius:6px;cursor:pointer}
    button:disabled{opacity:.6;cursor:default}
    footer{margin-top:1rem;font-size:.85rem;color:#475569}
    @media (max-width:520px){label{width:95px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Forgemaster Calculator — DPS Builder</h1>
      <div>Slots: <strong id="slot-count">8</strong></div>
    </header>

    <div class="card">
      <h2 style="margin-top:0">Equipment Slots</h2>
      <p style="margin:0 0 .5rem">Enter base Health and Damage per slot, choose two substats and enter their values.</p>

      <form id="dps-form">
        <div id="slots" class="slots"></div>

        <div style="margin-top:1rem;display:flex;gap:.5rem;align-items:center;flex-wrap:wrap">
          <button id="compute" type="button">Compute Summary</button>
          <button id="save" type="button">Save (local)</button>
          <button id="load" type="button">Load (local)</button>
          <button id="reset" type="button">Reset</button>
          <button id="export" type="button">Export JSON</button>
          <input id="import-file" type="file" accept="application/json" style="display:none" />
          <button id="import" type="button">Import JSON</button>
        </div>
      </form>
    </div>

    <div class="card">
      <h2 style="margin-top:0">Summary</h2>
      <div class="row" style="margin-bottom:.75rem"><label>Total HP</label><input id="total-hp" class="small" readonly><label style="width:120px">Total Damage</label><input id="total-dmg" class="small" readonly></div>
      <h3 style="margin:.5rem 0 .25rem">Current Data (JSON)</h3>
      <div id="preview" class="summary">{ }</div>
    </div>

    <footer>
      <small>Built for prototyping — you can customize substat options and calculations later.</small>
    </footer>
  </div>

  <script>
    const SUBSTAT_OPTIONS = [
      {v:'none', t:'None'},
      {v:'hp_flat', t:'HP (flat)'},
      {v:'hp_pct', t:'HP %'},
      {v:'atk_flat', t:'ATK (flat)'},
      {v:'atk_pct', t:'ATK %'},
      {v:'def_flat', t:'DEF (flat)'},
      {v:'def_pct', t:'DEF %'},
      {v:'spd', t:'SPD'},
      {v:'crit_rate', t:'Crit Rate'},
      {v:'crit_dmg', t:'Crit DMG'},
      {v:'effect', t:'Effectiveness'},
      {v:'resist', t:'Effect Resistance'}
    ];

    // Define slot names here (edit to customize)
    const SLOT_NAMES = ['head','chest','gloves','necklace','ring','weapon','boots','belt'];
    // slots with HP only
    const HEALTH_ONLY = ['head','chest','boots','belt'];
    // computed helper for damage-only slots
    const DAMAGE_ONLY = SLOT_NAMES.filter(n=>!HEALTH_ONLY.includes(n));
    // simple capitalization helper for UI
    function cap(s){ return (typeof s==='string' && s.length>0) ? (s[0].toUpperCase()+s.slice(1)) : s; }
    const SLOTS = SLOT_NAMES.length;
    const slotsContainer = document.getElementById('slots');
    const preview = document.getElementById('preview');
    const totalHpInput = document.getElementById('total-hp');
    const totalDmgInput = document.getElementById('total-dmg');

    function createSelect(name){
      const sel = document.createElement('select');
      sel.name = name;
      SUBSTAT_OPTIONS.forEach(o=>{
        const opt = document.createElement('option'); opt.value=o.v; opt.textContent=o.t; sel.appendChild(opt);
      });
      return sel;
    }

    function makeSlot(i){
      const div = document.createElement('div'); div.className='slot';
      const title = document.createElement('div'); title.style.fontWeight='600'; title.style.marginBottom='8px';
      const slotName = SLOT_NAMES[i] || ('Slot '+(i+1));
      title.textContent = cap(slotName);
      div.appendChild(title);

      // HP & DMG row
      const row1 = document.createElement('div'); row1.className='row';
      const labHp = document.createElement('label'); labHp.textContent='Health';
      const inpHp = document.createElement('input'); inpHp.type='number'; inpHp.name=`slot_${i}_hp`; inpHp.value='0'; inpHp.min='0'; inpHp.step='1'; inpHp.className='small';
      const labDmg = document.createElement('label'); labDmg.textContent='Damage'; labDmg.style.width='75px';
      const inpDmg = document.createElement('input'); inpDmg.type='number'; inpDmg.name=`slot_${i}_dmg`; inpDmg.value='0'; inpDmg.min='0'; inpDmg.step='1'; inpDmg.className='small';

      // disable fields based on slot role
      if(HEALTH_ONLY.includes(slotName)){
        inpDmg.value = 0; inpDmg.disabled = true; inpDmg.style.opacity = 0.6;
      } else {
        // damage-only or general -> if in DAMAGE_ONLY, disable HP
        if(DAMAGE_ONLY.includes(slotName)){
          inpHp.value = 0; inpHp.disabled = true; inpHp.style.opacity = 0.6;
        }
      }

      row1.appendChild(labHp); row1.appendChild(inpHp); row1.appendChild(labDmg); row1.appendChild(inpDmg);
      div.appendChild(row1);

      // Substat rows
      const row2 = document.createElement('div'); row2.className='row';
      const lab1 = document.createElement('label'); lab1.textContent='Substat 1';
      const sel1 = createSelect(`slot_${i}_sub_1`);
      const val1 = document.createElement('input'); val1.type='number'; val1.name=`slot_${i}_sub_1_val`; val1.value='0'; val1.step='any'; val1.className='small';
      row2.appendChild(lab1); row2.appendChild(sel1); row2.appendChild(val1);
      div.appendChild(row2);

      const row3 = document.createElement('div'); row3.className='row';
      const lab2 = document.createElement('label'); lab2.textContent='Substat 2';
      const sel2 = createSelect(`slot_${i}_sub_2`);
      const val2 = document.createElement('input'); val2.type='number'; val2.name=`slot_${i}_sub_2_val`; val2.value='0'; val2.step='any'; val2.className='small';
      row3.appendChild(lab2); row3.appendChild(sel2); row3.appendChild(val2);
      div.appendChild(row3);

      // Event listeners
      [inpHp, inpDmg, sel1, sel2, val1, val2].forEach(el=>el.addEventListener('input', updatePreview));

      return div;
    }

    function init(){
      // update visible slot count
      const sc = document.getElementById('slot-count'); if(sc) sc.textContent = SLOTS;
      for(let i=0;i<SLOTS;i++) slotsContainer.appendChild(makeSlot(i));
      document.getElementById('compute').addEventListener('click', computeSummary);
      document.getElementById('save').addEventListener('click', saveLocal);
      document.getElementById('load').addEventListener('click', loadLocal);
      document.getElementById('reset').addEventListener('click', resetForm);
      document.getElementById('export').addEventListener('click', exportJson);
      const importFile = document.getElementById('import-file');
      document.getElementById('import').addEventListener('click', ()=>importFile.click());
      importFile.addEventListener('change', importJson);
      updatePreview();
    }

    function readForm(){
      const data = {slots:[]};
      for(let i=0;i<SLOTS;i++){
        let hp = Number(document.querySelector(`[name="slot_${i}_hp"]`).value) || 0;
        let dmg = Number(document.querySelector(`[name="slot_${i}_dmg"]`).value) || 0;
        const sub1 = document.querySelector(`[name="slot_${i}_sub_1"]`).value;
        const sub1v = Number(document.querySelector(`[name="slot_${i}_sub_1_val"]`).value) || 0;
        const sub2 = document.querySelector(`[name="slot_${i}_sub_2"]`).value;
        const sub2v = Number(document.querySelector(`[name="slot_${i}_sub_2_val"]`).value) || 0;
        const slotName = SLOT_NAMES[i];
        if(HEALTH_ONLY.includes(slotName)) dmg = 0; else hp = 0; 
        data.slots.push({hp,dmg,sub1,sub1v,sub2,sub2v});
      }
      return data;
    }

    function updatePreview(){
      const data = readForm();
      preview.textContent = JSON.stringify(data,null,2);
      // live totals
      const totalHp = data.slots.reduce((s,x)=>s+x.hp,0);
      const totalDmg = data.slots.reduce((s,x)=>s+x.dmg,0);
      totalHpInput.value = totalHp;
      totalDmgInput.value = totalDmg;
    }

    function computeSummary(){
      // Simple compute: totals and consolidated substats
      const d = readForm();
      const totals = {totalHp:0,totalDmg:0,substats:{}};
      d.slots.forEach(s=>{
        totals.totalHp += s.hp;
        totals.totalDmg += s.dmg;
        if(s.sub1 !== 'none') totals.substats[s.sub1] = (totals.substats[s.sub1] || 0) + s.sub1v;
        if(s.sub2 !== 'none') totals.substats[s.sub2] = (totals.substats[s.sub2] || 0) + s.sub2v;
      });
      preview.textContent = JSON.stringify({summary:totals,slots:d.slots},null,2);
      totalHpInput.value = totals.totalHp;
      totalDmgInput.value = totals.totalDmg;
    }

    function saveLocal(){
      localStorage.setItem('dps_builder', JSON.stringify(readForm()));
      alert('Saved to localStorage');
    }

    function loadLocal(){
      const raw = localStorage.getItem('dps_builder');
      if(!raw){alert('No saved data');return}
      const obj = JSON.parse(raw);
      obj.slots.forEach((s,i)=>{
        const hpEl = document.querySelector(`[name="slot_${i}_hp"]`);
        const dmgEl = document.querySelector(`[name="slot_${i}_dmg"]`);
        if(hpEl) hpEl.value = s.hp || 0;
        if(dmgEl) dmgEl.value = s.dmg || 0;
        // enforce disabled/zero state
        const slotName = SLOT_NAMES[i];
        if(HEALTH_ONLY.includes(slotName)){
          if(dmgEl){ dmgEl.value = 0; dmgEl.disabled = true; dmgEl.style.opacity = 0.6; }
          if(hpEl) hpEl.disabled = false;
        } else {
          if(hpEl){ hpEl.value = 0; hpEl.disabled = true; hpEl.style.opacity = 0.6; }
          if(dmgEl) dmgEl.disabled = false;
        }
        const sub1 = document.querySelector(`[name="slot_${i}_sub_1"]`); if(sub1) sub1.value = s.sub1;
        const sub1v = document.querySelector(`[name="slot_${i}_sub_1_val"]`); if(sub1v) sub1v.value = s.sub1v;
        const sub2 = document.querySelector(`[name="slot_${i}_sub_2"]`); if(sub2) sub2.value = s.sub2;
        const sub2v = document.querySelector(`[name="slot_${i}_sub_2_val"]`); if(sub2v) sub2v.value = s.sub2v;
      });
      updatePreview();
      alert('Loaded saved data');
    }

    function exportJson(){
      const data = readForm();
      const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'dps_builder.json';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function importJson(e){
      const file = e.target.files && e.target.files[0];
      if(!file){ alert('No file selected'); return; }
      const reader = new FileReader();
      reader.onload = ()=>{
        try{
          const obj = JSON.parse(reader.result);
          if(!obj || !Array.isArray(obj.slots)){
            alert('Invalid JSON format: expected { slots: [...] }');
            return;
          }
          // populate slots (fill missing slots with defaults)
          for(let i=0;i<SLOTS;i++){
            const s = obj.slots[i] || {hp:0,dmg:0,sub1:'none',sub1v:0,sub2:'none',sub2v:0};
            const hpEl = document.querySelector(`[name="slot_${i}_hp"]`); if(hpEl) hpEl.value = s.hp || 0;
            const dmgEl = document.querySelector(`[name="slot_${i}_dmg"]`); if(dmgEl) dmgEl.value = s.dmg || 0;
            const slotName = SLOT_NAMES[i];
            if(HEALTH_ONLY.includes(slotName)){
              if(dmgEl){ dmgEl.value = 0; dmgEl.disabled = true; dmgEl.style.opacity = 0.6; }
              if(hpEl) hpEl.disabled = false;
            } else {
              if(hpEl){ hpEl.value = 0; hpEl.disabled = true; hpEl.style.opacity = 0.6; }
              if(dmgEl) dmgEl.disabled = false;
            }
            const sub1 = document.querySelector(`[name="slot_${i}_sub_1"]`); if(sub1) sub1.value = s.sub1 || 'none';
            const sub1v = document.querySelector(`[name="slot_${i}_sub_1_val"]`); if(sub1v) sub1v.value = s.sub1v || 0;
            const sub2 = document.querySelector(`[name="slot_${i}_sub_2"]`); if(sub2) sub2.value = s.sub2 || 'none';
            const sub2v = document.querySelector(`[name="slot_${i}_sub_2_val"]`); if(sub2v) sub2v.value = s.sub2v || 0;
          }
          updatePreview();
          e.target.value = ''; // reset file input so re-importing same file works
          alert('Imported JSON successfully');
        }catch(err){
          alert('Error parsing JSON: '+err.message);
        }
      };
      reader.readAsText(file);
    }

    function resetForm(){
      if(!confirm('Reset all values to 0?')) return;
      for(let i=0;i<SLOTS;i++){
        document.querySelector(`[name="slot_${i}_hp"]`).value = 0;
        document.querySelector(`[name="slot_${i}_dmg"]`).value = 0;
        document.querySelector(`[name="slot_${i}_sub_1"]`).value = 'none';
        document.querySelector(`[name="slot_${i}_sub_1_val"]`).value = 0;
        document.querySelector(`[name="slot_${i}_sub_2"]`).value = 'none';
        document.querySelector(`[name="slot_${i}_sub_2_val"]`).value = 0;
      }
      updatePreview();
    }

    // init
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>